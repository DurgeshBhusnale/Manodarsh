<!DOCTYPE html>
<html>
<head>
    <title>Emotion Monitoring</title>
</head>
<body>
    <h1>Soldier Data</h1>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Image</th>
            </tr>
        </thead>
        <tbody>
            {% for soldier in soldiers %}
            <tr>
                <td>{{ soldier[0] }}</td>
                <td>{{ soldier[1] }}</td>
                <td><img src="{{ soldier[5] }}" alt="User Image" width="100"></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Daily Averages ({{ today }})</h2>
    <table>
        <thead>
            <tr>
                <th>User ID</th>
                <th>Average Score</th>
                <th>Image</th>
            </tr>
        </thead>
        <tbody>
            {% for avg in daily_averages %}
            <tr>
                <td>{{ avg[0] }}</td>
                <td>{{ avg[1] }}</td>
                <td>
                    {% if avg[2] %}
                        <img src="data:image/jpeg;base64,{{ avg[2] | b64encode }}" alt="Representative Image" width="100">
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <form id="startDayForm" method="POST" action="/start_day">  <label for="date">Date:</label>
        <input type="date" id="date" name="date" required>  <button type="submit">Start Day</button>  </form>

    <button id="end_day">End Day</button>
    <br><br>
    <a href="/add_soldier">Add New Soldier</a>

    <script>
        const startDayForm = document.getElementById('startDayForm'); // Select the form
        const endDayButton = document.getElementById('end_day');

        startDayForm.addEventListener('submit', (event) => {  // Modified to handle form submission
            event.preventDefault(); // Prevent default form submission

            const formData = new FormData(startDayForm); // Create FormData object

            fetch('/start_day', {
                method: 'POST',
                body: formData // Include form data in the request body
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
                if (response.ok) { // Check if the response is ok (status code in the 200-299 range)
                    // Optionally, you can reset the form or update the UI
                    startDayForm.reset();
                } else {
                    alert(data.message); // Display error message
                }
            })
            .catch(error => {
                console.error("Error:", error);
            });
        });

        endDayButton.addEventListener('click', () => {
            fetch('/end_day', { method: 'POST' })
                .then(response => response.json())
                .then(data => console.log(data.message))
                .then(() => {
                    location.reload();
                });
        });
    </script>
</body>
</html>